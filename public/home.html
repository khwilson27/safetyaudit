<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="icon" href="assets/img/favicon/favicon.ico" type="image/png" />
    <link rel="shortcut icon" href="/favicon.ico" />
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="panel panel-primary">
                    <div class="panel-heading">Audits</div>
                    <div class="panel-body">
                        <div class="row">
                            <button type="button" class="btn btn-success">Add</button>
                            <button type="button" class="btn btn-secondary">Edit</button>
                            <button type="button" class="btn btn-danger">Delete</button>
                        </div>
                        <div class="row">
                            <table class="table" id="audit_table">
                                <tr>
                                    <th>Audit</th>
                                    <th>Date</th> 
                                </tr>
                                <tr style="background-color: #FFFF00" class="audit_item">
                                    <td>Report 1</td>
                                    <td>2019-01-01</td> 
                                </tr>
                                <tr class = "audit_item">
                                    <td>Report 2</td>
                                    <td>2019-01-27</td> 
                                </tr>
                            </table>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-primary">
                    <div class="panel-heading">Rooms</div>
                    <div class="panel-body">
                        <div class="row">
                                <button type="button" class="btn btn-success">Add</button>
                                <button type="button" class="btn btn-secondary">Edit</button>
                                <button type="button" class="btn btn-danger">Delete</button>
                        </div>
                        <div class="row">
                            <table class="table" id="room_table">
                                <tr style="background-color: #FFFF00">
                                    <td>Room 1</td>
                                </tr>
                                <tr>
                                    <td>Room 2</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-primary">
                    <div class="panel-heading">Checklist</div>
                    <div class="panel-body">
                            <div class="row">
                                    <button type="button" class="btn btn-secondary">Save</button>
                            </div>
                            <div class="row">
                                <table class="table">
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c1">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Fire extinguisher (
                                                            <input class="form-check-input" type="checkbox" value="" id="c1_ns">
                                                            <label class="form-check-label" for="defaultCheck1">not signed</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c1_b">
                                                            <label class="form-check-label" for="defaultCheck1">blocked</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c1_nm">
                                                            <label class="form-check-label" for="defaultCheck1">not mounted</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c1_po">
                                                            <label class="form-check-label" for="defaultCheck1">pin out</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c2">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Evacuation map (
                                                            <input class="form-check-input" type="checkbox" value="" id="c2_m">
                                                            <label class="form-check-label" for="defaultCheck1">missing</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c2_nor">
                                                            <label class="form-check-label" for="defaultCheck1">no evacuation route</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c2_b">
                                                            <label class="form-check-label" for="defaultCheck1">blocked</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c3">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Emergency kit (
                                                            <input class="form-check-input" type="checkbox" value="" id="c3_nl">
                                                            <label class="form-check-label" for="defaultCheck1">not located</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c3_ns">
                                                            <label class="form-check-label" for="defaultCheck1">not stocked</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c3_ic">
                                                            <label class="form-check-label" for="defaultCheck1">inside cabinet</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c4">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Emergency Flipchart (
                                                            <input class="form-check-input" type="checkbox" value="" id="c4_m">
                                                            <label class="form-check-label" for="defaultCheck1">missing</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c4_b">
                                                            <label class="form-check-label" for="defaultCheck1">blocked</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c4_o">
                                                            <label class="form-check-label" for="defaultCheck1">outdated</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c5">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Walls (
                                                            <input class="form-check-input" type="checkbox" value="" id="c5_50">
                                                            <label class="form-check-label" for="defaultCheck1">>50% decorated or </label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c5_20">
                                                            <label class="form-check-label" for="defaultCheck1">>20% decorated</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c6">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Structural Damage (
                                                            <input class="form-check-input" type="checkbox" value="" id="c6_ct">
                                                            <label class="form-check-label" for="defaultCheck1">ceiling tiles</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c6_l">
                                                            <label class="form-check-label" for="defaultCheck1">lights</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c6_fc">
                                                            <label class="form-check-label" for="defaultCheck1">floor/carpet</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c7">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Unorganized heavy items stored overhead (above 72")
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c8">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Alarms / Smoke detector (blocked)
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c9">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Cords (
                                                            <input class="form-check-input" type="checkbox" value="" id="c9_u">
                                                            <label class="form-check-label" for="defaultCheck1">unprotected</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c9_d">
                                                            <label class="form-check-label" for="defaultCheck1">disorderly</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c9_hec">
                                                            <label class="form-check-label" for="defaultCheck1">household extension cord</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c9_dc">
                                                            <label class="form-check-label" for="defaultCheck1">"daisy chaining"</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c9_ecup">
                                                            <label class="form-check-label" for="defaultCheck1">extension cord used permanently</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c10">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Unapproved chemical / Unlabeled
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c11">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Potential fire hazard (
                                                            <input class="form-check-input" type="checkbox" value="" id="c11_piaf">
                                                            <label class="form-check-label" for="defaultCheck1">Plug-in air fresh.</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c11_c">
                                                            <label class="form-check-label" for="defaultCheck1">candle</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c11_sh">
                                                            <label class="form-check-label" for="defaultCheck1">space heater</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c12">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Blocked electrical panel (min 36" clearance)
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>  
                                                <input class="form-check-input" type="checkbox" value="" id="c13">
                                                <label class="form-check-label" for="defaultCheck1">
                                                        Unsecured (
                                                            <input class="form-check-input" type="checkbox" value="" id="c13_s">
                                                            <label class="form-check-label" for="defaultCheck1">shelves</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c13_c">
                                                            <label class="form-check-label" for="defaultCheck1">cabinets</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c13_t">
                                                            <label class="form-check-label" for="defaultCheck1">TV</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c13_d">
                                                            <label class="form-check-label" for="defaultCheck1">DVD</label>
                                                            <input class="form-check-input" type="checkbox" value="" id="c13_v">
                                                            <label class="form-check-label" for="defaultCheck1">VCR</label>
                                                        )
                                                </label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="form-group">
                                                    <label for="notes">Notes:</label>
                                                    <textarea class="form-control rounded-0" id="exampleFormControlTextarea2" rows="3" id="notes"></textarea>
                                                </div>
                                            </td>
                                        </tr>
                                        
                                </table>
                            </div>
                        
                    </div>

                </div>
                <div class="panel panel-primary">
                    <div class="panel-heading">Generated Report</div>
                    <div class="panel-body">
                        <div class="row">
                                <button type="button" class="btn btn-secondary">Generate</button>
                        </div>
                        <div class="row">
                                The following rooms with big fire: 102, 104, Cafeteria.
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        </div>
    </div>
    
    <!-- JS -->
    <script type="text/javascript">

    $(document).ready(function() {
        
        var state = {};

        function clearHighlights () {
            $("tr").attr("style", "");
        }

        function getFormattedDate(date) {
            var year = date.getFullYear();
            var month = (1 + date.getMonth()).toString();
            month = month.length > 1 ? month : '0' + month;
            var day = date.getDate().toString();
            day = day.length > 1 ? day : '0' + day;
            return year + '-' + month + '-' + day;
        }

        let getInitialDataSetInitialState = function(AuditId = undefined) {
            $.ajax({
            url: "/api/audit/0",
            type: 'GET',
            success: 
                function(data) {

                    console.log(state);
                    let promise = new Promise(function(resolve, reject) {
                        state.AuditId = AuditId ? AuditId : data.auditData[0].id;
                        state.RoomId = data.roomData[0].id;
                        state.Data = data;
                        renderGivenState(data);
                    });
                    promise.then(
                        console.log(state),
                        $("#a" + state.AuditId).attr("style", "background-color: #FFFF00")
                    );
                    
                }
            });
        }
        
        let renderGivenState = function(data) {
            //Audit Items
            $("#audit_table").empty();
            $("#room_table").empty();

            let newTR_header = $("<tr>");
            let newTD_header_site = $("<th>").html("Site").appendTo(newTR_header);
            let newTD_header_date = $("<th>").html("Date").appendTo(newTR_header);
            newTR_header.appendTo($("#audit_table"));

            for (let i = 0; i < data.auditData.length; i++) {
                let newTR = $("<tr>");
                let newTD_site = $("<td>");
                let newTD_date = $("<td>");

                let date = new Date(data.auditData[i].date).toString();

                newTR.attr("data-AuditId", "a" + data.auditData[i].id);
                newTR.addClass("audit_item");

                newTD_site.html(data.auditData[i].site);
                newTD_date.html(date.substr(0,15));
                newTR.append(newTD_site).append(newTD_date);
                newTR.appendTo($("#audit_table"));
            }

            for (let i = 0; i < data.roomData.length; i++) {
                let newTR = $("<tr>");
                let newTD_room = $("<td>");

                newTR.attr("data-RoomId", "r" + data.roomData[i].id);
                newTR.addClass("room_item");

                newTD_room.html(data.roomData[i].name);
                newTR.append(newTD_room);
                newTR.appendTo($("#room_table"));
            }
        }

        getInitialDataSetInitialState();

    })
    </script>
</body>

</html>